<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amy Heather">
<meta name="dcterms.date" content="2024-07-30">

<title>Day 3 – Reproducing Kim et al.&nbsp;2021</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../quarto_site/stars_logo_blue.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../quarto_site/stars_logo_blue.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Reproducing Kim et al.&nbsp;2021</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../quarto_site/study_publication.html"> 
<span class="menu-text">Original study</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reproduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reproduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reproduction">    
        <li>
    <a class="dropdown-item" href="../../../quarto_site/reproduction_readme.html">
 <span class="dropdown-text">README</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-evaluation" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Evaluation</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-evaluation">    
        <li>
    <a class="dropdown-item" href="../../../evaluation/scope.html">
 <span class="dropdown-text">Scope</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../evaluation/reproduction_success.html">
 <span class="dropdown-text">Reproduction success</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../evaluation/badges.html">
 <span class="dropdown-text">Journal badges</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../evaluation/artefacts.html">
 <span class="dropdown-text">STARS framework</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../evaluation/reporting.html">
 <span class="dropdown-text">Reporting guidelines</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../logbook/logbook.html"> 
<span class="menu-text">Logbook</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../evaluation/reproduction_report.html"> 
<span class="menu-text">Summary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../evaluation/reflections.html"> 
<span class="menu-text">Reflections</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pythonhealthdatascience/stars-reproduce-kim-2021/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Day 3</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">reproduce</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Amy Heather </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 30, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#timings-below-working-on-table-2-and-figure-1" id="toc-timings-below-working-on-table-2-and-figure-1" class="nav-link active" data-scroll-target="#timings-below-working-on-table-2-and-figure-1">Timings below: Working on Table 2 and Figure 1</a>
  <ul class="collapse">
  <li><a href="#github-repository-dates" id="toc-github-repository-dates" class="nav-link" data-scroll-target="#github-repository-dates">GitHub repository dates</a></li>
  <li><a href="#incrementing-number-of-people-for-65yo-scen1" id="toc-incrementing-number-of-people-for-65yo-scen1" class="nav-link" data-scroll-target="#incrementing-number-of-people-for-65yo-scen1">Incrementing number of people for 65yo scen1</a></li>
  <li><a href="#scaling-the-numbers" id="toc-scaling-the-numbers" class="nav-link" data-scroll-target="#scaling-the-numbers">Scaling the numbers</a></li>
  <li><a href="#scenario-0" id="toc-scenario-0" class="nav-link" data-scroll-target="#scenario-0">Scenario 0</a></li>
  <li><a href="#confirming-which-column-gives-number-of-operations" id="toc-confirming-which-column-gives-number-of-operations" class="nav-link" data-scroll-target="#confirming-which-column-gives-number-of-operations">Confirming which column gives number of operations</a></li>
  <li><a href="#excess-deaths" id="toc-excess-deaths" class="nav-link" data-scroll-target="#excess-deaths">Excess deaths</a></li>
  <li><a href="#two-million-people" id="toc-two-million-people" class="nav-link" data-scroll-target="#two-million-people">Two million people</a></li>
  </ul></li>
  <li><a href="#running-65-year-old-scenario-2" id="toc-running-65-year-old-scenario-2" class="nav-link" data-scroll-target="#running-65-year-old-scenario-2">13.29-13.39: Running 65 year old scenario 2</a></li>
  <li><a href="#running-surv-scenario-1" id="toc-running-surv-scenario-1" class="nav-link" data-scroll-target="#running-surv-scenario-1">14.00-14.06: Running surv scenario 1</a></li>
  <li><a href="#creating-figure-1" id="toc-creating-figure-1" class="nav-link" data-scroll-target="#creating-figure-1">13.40-13.44, 13.51-13.59, 14.07-14.29: Creating Figure 1</a></li>
  <li><a href="#checking-scenario-1-simulation-table-2-results" id="toc-checking-scenario-1-simulation-table-2-results" class="nav-link" data-scroll-target="#checking-scenario-1-simulation-table-2-results">14.42-14.49: Checking scenario 1 simulation table 2 results</a></li>
  <li><a href="#table-2" id="toc-table-2" class="nav-link" data-scroll-target="#table-2">15.00-15.59: Table 2</a></li>
  <li><a href="#fix-later-scenarios" id="toc-fix-later-scenarios" class="nav-link" data-scroll-target="#fix-later-scenarios">16.12-16.27: Fix later scenarios</a></li>
  <li><a href="#start-on-figure-2" id="toc-start-on-figure-2" class="nav-link" data-scroll-target="#start-on-figure-2">16.42-16.55: Start on Figure 2</a></li>
  <li><a href="#timings" id="toc-timings" class="nav-link" data-scroll-target="#timings">Timings</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/pythonhealthdatascience/stars-reproduce-kim-2021/edit/main/logbook/posts/2024_07_30/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/pythonhealthdatascience/stars-reproduce-kim-2021/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reproduced Figure 1 and Table 2. Total time used: 8h 59m (22.5%).</p>
</div>
</div>
<section id="timings-below-working-on-table-2-and-figure-1" class="level2">
<h2 class="anchored" data-anchor-id="timings-below-working-on-table-2-and-figure-1">Timings below: Working on Table 2 and Figure 1</h2>
<p>Timings:</p>
<ul>
<li>09.10-09.11</li>
<li>09.20-09.22</li>
<li>09.30-09.40</li>
<li>09.52-10.44</li>
<li>10.51-10.56</li>
<li>11.02-11.56</li>
<li>12.59-13.27</li>
</ul>
<section id="github-repository-dates" class="level3">
<h3 class="anchored" data-anchor-id="github-repository-dates">GitHub repository dates</h3>
<p>I realised I had forgotten to check the GitHub repository dates v.s. paper dates. The article was published in June 2021. There are three commits after this point:</p>
<ul>
<li>19 July 2021 - “Adding SWAN models to repository” - relevant changes:
<ul>
<li><code>debug=F</code> and some error handling in <code>processPersons()</code> from <code>DES_Model.R</code></li>
<li>Changing from <code>v1other$aortaDiameterThresholds &lt;- c(3.0, 4.5, 5.5)</code> to <code>v1other$aortaDiameterThresholds &lt;- list(c(3.0, 4.5, 5.5))</code> in <code>input/NAAASP_Men_2020-05-11/DES_Data_Input_NAAASP_Men_30years_time_horizon_2020-05-11.R</code></li>
<li>Removing an associated <code>.xlsx</code> file for 202-05-11</li>
</ul></li>
<li>19 July 2021 - “Updating README.md”
<ul>
<li>More detail in README (see below)</li>
</ul></li>
<li>12 February 2024 - “Fixed checks with vectorised elements, which was causing errors in R v4.3”
<ul>
<li>Add .gitignore</li>
<li>Modification in <code>Auxillary_Functions.R</code></li>
<li>Formatting in <code>DES_Model.R</code></li>
</ul></li>
</ul>
<p>Original:</p>
<blockquote class="blockquote">
<p>The following directories are included:</p>
<p>/models – R scripts that run the DES models for AAA screening</p>
<p>/models/Example – An example script to run the DES is contained here</p>
<p>/functions – Contains the DES model code</p>
<p>/input – Contains the input parameters and .csv files needed to run the DES models</p>
<p>/input/NAAASP_Men_2020-05-11 – Updated parameters for AAA screening in men, updated as of 11/05/2020</p>
<p>/output – Directory where Rdata output files are saved</p>
</blockquote>
<p>New:</p>
<blockquote class="blockquote">
<p>The following directories are included:</p>
<ul>
<li><p>/models – R scripts that run the DES models for AAA screening</p></li>
<li><p>/models/Example – An example script to run the DES is contained here</p></li>
<li><p>/models/SWAN – Screening Women for Abdominal Aortic Aneurysm (SWAN) model scripts. See our <a href="http://dx.doi.org/10.1016/S0140-6736(18)31222-4">Lancet publication</a> and <a href="https://doi.org/10.3310/hta22430">HTA report</a> for further details</p></li>
<li><p>/models/NAAASP_COVID_modelling – Scripts for modelling the impact of changes to Abdominal Aortic Aneurysm screening and treatment services in England during the COVID-19 pandemic. See our <a href="https://doi.org/10.1371/journal.pone.0253327">PLOS ONE</a> publication for further details</p></li>
<li><p>/functions – Contains the DES model code</p></li>
<li><p>/input – Contains the input parameters and .csv files needed to run the DES models</p></li>
<li><p>/input/SWAN – Screening Women for Abdominal Aortic Aneurysm (SWAN) input parameters. See our <a href="http://dx.doi.org/10.1016/S0140-6736(18)31222-4">Lancet publication</a> and <a href="https://doi.org/10.3310/hta22430">HTA report</a> for further details</p></li>
<li><p>/input/NAAASP_COVID_modelling – Input parameters for modelling the impact of changes to Abdominal Aortic Aneurysm screening and treatment services in England during the COVID-19 pandemic. See our <a href="https://doi.org/10.1371/journal.pone.0253327">PLOS ONE</a> publication for further details</p></li>
<li><p>/input/NAAASP_Men_2020-05-11 – Updated parameters for AAA screening in men, updated as of 11/05/2020</p></li>
<li><p>/output – Directory where Rdata output files are saved</p></li>
</ul>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given how far I have progressed with this, I won’t go back to using the version as of publication, but we should bare this in mind later.</p>
</div>
</div>
</section>
<section id="incrementing-number-of-people-for-65yo-scen1" class="level3">
<h3 class="anchored" data-anchor-id="incrementing-number-of-people-for-65yo-scen1">Incrementing number of people for 65yo scen1</h3>
<p>Ran full script of <code>run_aaamodel-65yo_scen1.R</code> with 100,000 people and parallel. However, this evidently is still too few people, looking at the results.</p>
<div id="ac21133d" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">'tab2_100k.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">delayscr</th>
<th data-quarto-table-cell-role="th">excess_death</th>
<th data-quarto-table-cell-role="th">excess_op</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.25</td>
<td>-6</td>
<td>-3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.50</td>
<td>-5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.00</td>
<td>-6</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.00</td>
<td>-1</td>
<td>-3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3.00</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>4.00</td>
<td>25</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>5.00</td>
<td>41</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I pulled changes to files and renv onto remote computer, and then ran that with 1,000,000 people. To open and change file:</p>
<pre><code>nano 'models/NAAASP_COVID_modelling/run_aaamodel_65yo_scen1.R'</code></pre>
<p>To run:</p>
<pre><code>Rscript -e "source('models/NAAASP_COVID_modelling/run_aaamodel_65yo_scen1.R')"</code></pre>
<p>Per run this took:</p>
<ul>
<li><strong>3 minutes 46 seconds</strong> on remote computer - so estimated 30 minutes in total.</li>
<li><strong>13 minutes 44 seconds</strong> on local computer - so would be an estimated 1 hour 50 minutes in total</li>
</ul>
<p>Looking at the <strong>convergence plots</strong> (supplementary figure 1 and 2), 1 million people is nearing closer to convergence - but 2 million even more-so.</p>
<div id="8332898b" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">'tab2_1m.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">delayscr</th>
<th data-quarto-table-cell-role="th">aaadead</th>
<th data-quarto-table-cell-role="th">emeropen</th>
<th data-quarto-table-cell-role="th">excess_death</th>
<th data-quarto-table-cell-role="th">excess_op</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00</td>
<td>9226</td>
<td>2830</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.25</td>
<td>9200</td>
<td>2824</td>
<td>-26</td>
<td>-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.50</td>
<td>9194</td>
<td>2843</td>
<td>-32</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.00</td>
<td>9199</td>
<td>2830</td>
<td>-27</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.00</td>
<td>9210</td>
<td>2836</td>
<td>-16</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3.00</td>
<td>9298</td>
<td>2878</td>
<td>72</td>
<td>48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>4.00</td>
<td>9423</td>
<td>2933</td>
<td>197</td>
<td>103</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>5.00</td>
<td>9612</td>
<td>2993</td>
<td>386</td>
<td>163</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="scaling-the-numbers" class="level3">
<h3 class="anchored" data-anchor-id="scaling-the-numbers">Scaling the numbers</h3>
<p>Looking at the result, I’m a little uncertain over the numbers we are getting. Looking at Table 2’s caption, I’m thinking that perhaps I may need to scale these (as using the raw numbers from the simulation, we’d expect these to be less than the table). The caption mentions that the:</p>
<ul>
<li>National male 65 year old cohort for England: n = 279,798</li>
<li>Expected AAA deaths over 30y in status quo = 2564</li>
<li>Expected emergency operations over 30y in status quo = 1041</li>
</ul>
<p>I tried scaling the results so that it reflects deaths expected if population were 279,798 (rather than 1 million). I scaled the results from <code>aaadead</code> and <code>emerevar</code> (e.g.&nbsp;<code>round(279798*(aaadead/1000000))</code>). The number of deaths looks similar to the expected from Table 2 (2564), but the number of emergency operations is very different.</p>
<div id="dde76f35" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">'scaled_1m.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">delayscr</th>
<th data-quarto-table-cell-role="th">aaadead</th>
<th data-quarto-table-cell-role="th">scaled_dead</th>
<th data-quarto-table-cell-role="th">scaled_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00</td>
<td>9226</td>
<td>2581</td>
<td>261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.25</td>
<td>9200</td>
<td>2574</td>
<td>261</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.50</td>
<td>9194</td>
<td>2572</td>
<td>261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.00</td>
<td>9199</td>
<td>2574</td>
<td>261</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.00</td>
<td>9210</td>
<td>2577</td>
<td>261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3.00</td>
<td>9298</td>
<td>2602</td>
<td>261</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>4.00</td>
<td>9423</td>
<td>2637</td>
<td>261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>5.00</td>
<td>9612</td>
<td>2689</td>
<td>261</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="scenario-0" class="level3">
<h3 class="anchored" data-anchor-id="scenario-0">Scenario 0</h3>
<p>I was wondering whether this should be compared against the result from the status quo script rather than from when delay is 0 (or whether that should just be the same thing anyway!).</p>
<p>I repeated this for the results from scenario 0 (status quo):</p>
<pre><code>scale_dead_s0 &lt;- y65_s0 %&gt;%
  select(aaadead) %&gt;%
  mutate(scaled_dead = round(279798*(aaadead/1000000)))
write.csv(scale_dead_s0, "../../logbook/posts/2024_07_30/dead_s0.csv", row.names=FALSE)</code></pre>
<p>It came out exactly the same, so seems, no issue with using the 0 result from the run of <code>scen1</code>.</p>
<div id="ca483692" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">'dead_s0.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">aaadead</th>
<th data-quarto-table-cell-role="th">scaled_dead</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9226</td>
<td>2581</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="confirming-which-column-gives-number-of-operations" class="level3">
<h3 class="anchored" data-anchor-id="confirming-which-column-gives-number-of-operations">Confirming which column gives number of operations</h3>
<p>Given that number of emergency operations looked very different, I was suspicious if I was using the correct column for this. It seems clear that deaths and ruptures are <code>aaadead</code> and <code>rupt</code> respectively, but I was less certain for surgeries (<code>elecopen</code> vs <code>elecevar</code>) (<code>emeropen</code> vs <code>emerevar</code>).</p>
<p>I tried applying scaling to every column from row 1, to see which came out most similar.</p>
<pre><code>as.data.frame(t(head(y65_s1, 1))) %&gt;%
  rename(result = 1) %&gt;%
  mutate(scaled = round(279798*(result/n_person)))</code></pre>
<p>Based on the names, there are a few candidates for emergency operations: <code>emerevar</code>, <code>emeropen</code>, <code>reintemerevar</code> and <code>reintemeropen</code>. I’m not certain what the difference is between these, but starting with their scaled values:</p>
<ul>
<li><code>emerevar</code> - 242</li>
<li><code>emeropen</code> - 790</li>
<li><code>reintemerevar</code> - 935</li>
<li><code>reintemeropen</code> - 183</li>
</ul>
<p>The expected number is 1041, so reintemerevar does appear closest.</p>
<div id="5463537e" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">'scale_all_first_row.csv'</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">result</th>
<th data-quarto-table-cell-role="th">scaled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n</td>
<td>1000000.00</td>
<td>279798</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">delayscr</td>
<td>0.25</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">inv</td>
<td>997073.00</td>
<td>278979</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">scr</td>
<td>748352.00</td>
<td>209387</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">reinv</td>
<td>135543.00</td>
<td>37925</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nonatt</td>
<td>248721.00</td>
<td>69592</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">monitor</td>
<td>265786.00</td>
<td>74366</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">dropout</td>
<td>9445.00</td>
<td>2643</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oppdet</td>
<td>28438.00</td>
<td>7957</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">consult</td>
<td>25555.00</td>
<td>7150</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">elecevar</td>
<td>10721.00</td>
<td>3000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">elecopen</td>
<td>4739.00</td>
<td>1326</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">rupt</td>
<td>10093.00</td>
<td>2824</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">emerevar</td>
<td>865.00</td>
<td>242</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">emeropen</td>
<td>2824.00</td>
<td>790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">reintelecevar</td>
<td>3340.00</td>
<td>935</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">reintemerevar</td>
<td>3340.00</td>
<td>935</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">reintemeropen</td>
<td>655.00</td>
<td>183</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">aaadead</td>
<td>9200.00</td>
<td>2574</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nonaaadead</td>
<td>909861.00</td>
<td>254577</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I also then looked into the repository, for any written explanation for each variable, or the code behind it, to help confirm which is appropriate. Looking across the repository, these columns are created within each of the scenario scripts. From <code>run_aaamodel_65yo_scen1.R</code>:</p>
<pre><code>elecevar&lt;-Eventsandcosts(scen1.invite)[14,2]
elecopen&lt;-Eventsandcosts(scen1.invite)[15,2]

emerevar&lt;-Eventsandcosts(scen1.invite)[17,2]
emeropen&lt;-Eventsandcosts(scen1.invite)[18,2]

reintelecevar&lt;-Eventsandcosts(scen1.invite)[21,2]
reintemerevar&lt;-Eventsandcosts(scen1.invite)[21,2]</code></pre>
<p>Looking directly at the output of <code>Eventsandcosts(scen1.invite)</code> I can see that these match up with:</p>
<ul>
<li>14 - <code>electiveSurgeryEvar</code></li>
<li>15 - <code>electiveSurgeryOpen</code></li>
<li>17 - <code>emergencySurgeryEvar</code></li>
<li>18 - <code>emergencySurgeryOpen</code></li>
<li>21- <code>reinterventionAfterElectiveEvar</code></li>
</ul>
<p>I’m not certain why <code>reintemerevar</code> uses 21 and not 22, as 22 is <code>reinterventionAfterEmergencyEvar</code>, but this appears to be the same in each of the scenario scripts.</p>
<p>These are assigned from costs, and <code>v2$costs</code> is in the data dictionary, <code>DES_Input_Definitions.xlsx</code>:</p>
<ul>
<li><code>electiveSurgeryEvar</code>: Elective EVAR repair</li>
<li><code>electiveSurgeryOpen</code>: Elective Open repair</li>
<li><code>emergencySurgeryEvar</code>: Emergency EVAR repair</li>
<li><code>emergencySurgeryOpen</code>: Emergency Open repair</li>
<li><code>reinterventionAfterElectiveEvar</code>: Re-intervention after elective EVAR</li>
</ul>
<p>Having looked at this, I am presuming that the number of emergency operations would be given by combining <code>emergencySurgeryEvar</code> (17) (<code>emerevar</code>) and <code>emergencySurgeryOpen</code> (18) (<code>emeropen</code>).</p>
<p>Once I did that, the numbers looked much closer to the expected 1041 from the paper, with 1034 from 1 million people, and 1028 from 2 million people.</p>
</section>
<section id="excess-deaths" class="level3">
<h3 class="anchored" data-anchor-id="excess-deaths">Excess deaths</h3>
<p>I’m seeing some negatives (but the paper does not, and has several 0). I’m wondering if, as the result is “excess” deaths, perhaps I should only be counting when it was over 0 (and setting negative numbers to 0), so I altered it accordingly.</p>
<p>I also trimmed down the rows displayed for Table 2, to make the article.</p>
</section>
<section id="two-million-people" class="level3">
<h3 class="anchored" data-anchor-id="two-million-people">Two million people</h3>
<p>I ran <code>run_aaamodel_65yo_scen1.R</code> again but with 2 million people, as that looks like a more appropriate figure from the convergence plots, but I wasn’t certain if:</p>
<ul>
<li><ol type="a">
<li>the remote computer would manage it (process killed when ran with 10 million)</li>
</ol></li>
<li><ol start="2" type="a">
<li>how long it would take</li>
</ol></li>
<li><ol start="3" type="a">
<li>how much of a difference it would make</li>
</ol></li>
</ul>
<p>RE: (a) - it did manage it. While running, I did note we are now getting very large objects from each run (e.g.&nbsp;<code>processPersons is about to return an object of size 4.5 Gb</code>)</p>
<p>RE: (b) - the time for one run with 2 million people was <strong>11 minutes 20 seconds</strong>. For all eight runs, it took a total of “1.01512100968096” (which is weird - normally it gives me a result in minutes). If we assume this is hours, it’s just over an hour. My estimate based on the time for one run would be 1 hour 30 minutes. Have changed the timing statement to use difftime instead with units specified to avoid this issue in future.</p>
<p>RE: (c) - the results are pretty similar. I renamed the output files to we had results with 1 million and 2 million, then applied same function to create table 2, and they were pretty similar.</p>
<div id="b843b4a0" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'tab2_correct_1m.csv'</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'tab2_correct_2m.csv'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead</th>
<th data-quarto-table-cell-role="th">excess_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>21</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>56</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>108</td>
<td>56</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead</th>
<th data-quarto-table-cell-role="th">excess_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>20</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>50</td>
<td>31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>105</td>
<td>60</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Given their similarity, I will continue with running the simulation with 1 million people for the time being, since running with 2 million was much longer and very computationally expensive.</p>
</section>
</section>
<section id="running-65-year-old-scenario-2" class="level2">
<h2 class="anchored" data-anchor-id="running-65-year-old-scenario-2">13.29-13.39: Running 65 year old scenario 2</h2>
<p>Scenario 2 has a delay to invitation of 6 months, and attendance of 45 to 75%. This is required for Table 2, which also displays results from attendance of 65%, 55% and 45% (compared against 75%).</p>
<p>I set this up to run on the remote computer, with the changes as before, of:</p>
<ul>
<li>Using <strong>parallel</strong></li>
<li><strong>1 million</strong></li>
<li>Saving the results to <strong>csv</strong></li>
<li>Commenting out <code>list(v1other$aortaDiameterThresholds)</code></li>
<li>Timings for one run and all runs</li>
</ul>
<p>Timings:</p>
<ul>
<li>One run: 3.952 minutes = 237 seconds = 3 minutes 57 seconds</li>
<li>Full run: 19.123 minutes = 1147 seconds = 19 minutes 7 seconds</li>
</ul>
</section>
<section id="running-surv-scenario-1" class="level2">
<h2 class="anchored" data-anchor-id="running-surv-scenario-1">14.00-14.06: Running surv scenario 1</h2>
<p>Midway through creating figure 1, I set remote computer to run another scenario.</p>
<p>Amended script as did for 65yo scen2, with an additional fix too - correct path to model script to <code>DES_Model.R</code> - and then ran on remote machine.</p>
<p>Timings:</p>
<ul>
<li>One run: 13.368 minutes = 802 seconds = 13 minutes 22 seconds</li>
<li>Full run: 70.183 minutes = 4211 seconds = 1 hour 10 minutes 11 seconds</li>
</ul>
<p>This runtime reaffirmed for me the use of 1,000,000 people (rather than 2,000,000).</p>
</section>
<section id="creating-figure-1" class="level2">
<h2 class="anchored" data-anchor-id="creating-figure-1">13.40-13.44, 13.51-13.59, 14.07-14.29: Creating Figure 1</h2>
<p>Whilst that ran - and then, setting others to run during this too (hence time jumps) - I set about creating Figure 1 from the results of scenario 1 with 1 million people.</p>
<p>Add <code>ggplot2</code> (to make plots) and <code>tidyr</code> (to melt dataframe) to renv.</p>
<p>Wrote code to create figure, and was satisified this was reproduced at 14.29.</p>
<div id="13cc5a10" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'../'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> timings <span class="im">import</span> calculate_times</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Minutes used prior to today</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>used_to_date <span class="op">=</span> <span class="dv">243</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Times from today</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> [</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.10'</span>, <span class="st">'09.11'</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.20'</span>, <span class="st">'09.22'</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.30'</span>, <span class="st">'09.40'</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.52'</span>, <span class="st">'10.44'</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'10.51'</span>, <span class="st">'10.56'</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'11.02'</span>, <span class="st">'11.56'</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'12.59'</span>, <span class="st">'13.27'</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.29'</span>, <span class="st">'13.39'</span>),</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.40'</span>, <span class="st">'13.44'</span>),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.51'</span>, <span class="st">'13.59'</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.00'</span>, <span class="st">'14.06'</span>),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.07'</span>, <span class="st">'14.29'</span>)]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>calculate_times(used_to_date, times)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time spent today: 202m, or 3h 22m
Total used to date: 445m, or 7h 25m
Time remaining: 1955m, or 32h 35m
Used 18.5% of 40 hours max</code></pre>
</div>
</div>
</section>
<section id="checking-scenario-1-simulation-table-2-results" class="level2">
<h2 class="anchored" data-anchor-id="checking-scenario-1-simulation-table-2-results">14.42-14.49: Checking scenario 1 simulation table 2 results</h2>
<p>Now that we have the function to process scenario 1 correctly, I went back to re-run the results from fewer numbers of people, just to reaffirm whether the chosen number is appropriate (or whether we could use fewer).</p>
<p>I downloaded the results from my GitHub commit history, renaming the files to indicating the number of people.</p>
<p>With each of the variants I’d tried, it is apparent that none below 1 million were appropriate. It is possible that there could have been an appropriate inbetween value that I hadn’t tried (e.g.&nbsp;500,000), but for now, I will stick with 1 million.</p>
<div id="55ed6574" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'65y_s1_tab2_1k.csv'</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'65y_s1_tab2_10k.csv'</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'65y_s1_tab2_100k.csv'</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'65y_s1_tab2_1m.csv'</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'65y_s1_tab2_2m.csv'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>0 (NA)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0 (NA)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>0 (NA)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>0 (NA)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>279 (NA)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>279 (NA)</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>56 (0)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0 (0)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>56 (0)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>56 (0)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>140 (0)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>196 (0)</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>0 (6)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0 (0)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>0 (0)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>5 (6)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>70 (25)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>114 (25)</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>0 (3)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0 (0)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>0 (1)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>21 (14)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>56 (35)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>108 (56)</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months</th>
<th data-quarto-table-cell-role="th">excess_dead_emer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6m</td>
<td>0 (0)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12m</td>
<td>0 (0)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>24m</td>
<td>0 (0)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>36m</td>
<td>20 (11)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>48m</td>
<td>50 (31)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>60m</td>
<td>105 (60)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="table-2" class="level2">
<h2 class="anchored" data-anchor-id="table-2">15.00-15.59: Table 2</h2>
<p>Modified function so it could be used to process both scenarios, then combined into a single table.</p>
<p>I was satisfied this was reproduced (within expected variation from running with less people) at 15.59.</p>
<div id="75ef2b3a" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'../'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> timings <span class="im">import</span> calculate_times</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Minutes used prior to today</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>used_to_date <span class="op">=</span> <span class="dv">243</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Times from today</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> [</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.10'</span>, <span class="st">'09.11'</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.20'</span>, <span class="st">'09.22'</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.30'</span>, <span class="st">'09.40'</span>),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.52'</span>, <span class="st">'10.44'</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'10.51'</span>, <span class="st">'10.56'</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'11.02'</span>, <span class="st">'11.56'</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'12.59'</span>, <span class="st">'13.27'</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.29'</span>, <span class="st">'13.39'</span>),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.40'</span>, <span class="st">'13.44'</span>),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.51'</span>, <span class="st">'13.59'</span>),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.00'</span>, <span class="st">'14.06'</span>),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.07'</span>, <span class="st">'14.29'</span>),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.42'</span>, <span class="st">'14.49'</span>),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'15.00'</span>, <span class="st">'15.59'</span>)]</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>calculate_times(used_to_date, times)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time spent today: 268m, or 4h 28m
Total used to date: 511m, or 8h 31m
Time remaining: 1889m, or 31h 29m
Used 21.3% of 40 hours max</code></pre>
</div>
</div>
</section>
<section id="fix-later-scenarios" class="level2">
<h2 class="anchored" data-anchor-id="fix-later-scenarios">16.12-16.27: Fix later scenarios</h2>
<p>Fixed surv scenarios 2 to 4e (although not yet running as potentially insufficient time to complete before end of work day). As above, fixes include:</p>
<ul>
<li>Using <strong>parallel</strong></li>
<li><strong>1 million</strong></li>
<li>Saving the results to <strong>csv</strong></li>
<li>Commenting out <code>list(v1other$aortaDiameterThresholds)</code></li>
<li>Timings for one run and all runs</li>
<li>Correcting filename when source <code>DES_Model.R</code></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>I haven’t modified the provided structure of seperate scripts, but this structure does make it challenging when you want to change a parameter across the runs, as you have to carefully change each of the scripts. It would be easier if they were controlled by a single set of shared parameters.</p>
</div>
</div>
</section>
<section id="start-on-figure-2" class="level2">
<h2 class="anchored" data-anchor-id="start-on-figure-2">16.42-16.55: Start on Figure 2</h2>
<p>Create function based on Figure 1, so can reuse same processing code to generate dataframe for the figure.</p>
</section>
<section id="timings" class="level2">
<h2 class="anchored" data-anchor-id="timings">Timings</h2>
<div id="5a538e62" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'../'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> timings <span class="im">import</span> calculate_times</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Minutes used prior to today</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>used_to_date <span class="op">=</span> <span class="dv">243</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Times from today</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> [</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.10'</span>, <span class="st">'09.11'</span>),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.20'</span>, <span class="st">'09.22'</span>),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.30'</span>, <span class="st">'09.40'</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'09.52'</span>, <span class="st">'10.44'</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'10.51'</span>, <span class="st">'10.56'</span>),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'11.02'</span>, <span class="st">'11.56'</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'12.59'</span>, <span class="st">'13.27'</span>),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.29'</span>, <span class="st">'13.39'</span>),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.40'</span>, <span class="st">'13.44'</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'13.51'</span>, <span class="st">'13.59'</span>),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.00'</span>, <span class="st">'14.06'</span>),</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.07'</span>, <span class="st">'14.29'</span>),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'14.42'</span>, <span class="st">'14.49'</span>),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'15.00'</span>, <span class="st">'15.59'</span>),</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'16.12'</span>, <span class="st">'16.27'</span>),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'16.42'</span>, <span class="st">'16.55'</span>)]</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>calculate_times(used_to_date, times)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time spent today: 296m, or 4h 56m
Total used to date: 539m, or 8h 59m
Time remaining: 1861m, or 31h 1m
Used 22.5% of 40 hours max</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pythonhealthdatascience\.github\.io\/stars-reproduce-kim-2021\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://github.com/pythonhealthdatascience"><img src="https://raw.githubusercontent.com/pythonhealthdatascience/stars-logo/main/stars_logo_blue_text.png" class="img-fluid" alt="STARS" width="300"></a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../CHANGELOG.md">
<p>Changelog</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../quarto_site/license.html">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../CONTRIBUTING.md">
<p>Contributing</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/pythonhealthdatascience/stars-reproduce-kim-2021/edit/main/logbook/posts/2024_07_30/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/pythonhealthdatascience/stars-reproduce-kim-2021/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pythonhealthdatascience/stars-reproduce-kim-2021/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>